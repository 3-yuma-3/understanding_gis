# [空間検索](https://www.esrij.com/gis-guide/spatial/spatial-query/)
## GISにおける検索


## 空間検索とは
- 空間検索
  - GIS が持つ検索機能のうち、空間的な関係性に基づいて地物を検索する機能
- 「隣接している」や「500m 以内にある」というような空間的な関係性をもとに、駅とビルの相対的な位置関係から目的のデータを特定する。
- GIS のデータは、主題によって個別の層（レイヤー）で管理される
- これら個々のレイヤーを重ね合わせることで、地物の位置を容易に比較でき、空間的な関係性をとらえることが可能になる。

## 空間検索の種類

===

# [密度解析](https://www.esrij.com/gis-guide/spatial/density-analysis/)
## 密度解析とは
- 密度解析
  - 各地点の計測値の数量と空間的な関係をもとに全体的な数量の分布を推計する処理
  - たとえば、飲食店の位置から密度を解析することによって、どこに飲食店が多いのかを求めることができる

## ArcGISでの密度解析
- ArcGIS での密度解析では、ポイントやラインから単位面積当たりの密度を推計したサーフェスを作成する。
- ArcGIS Spatial Analyst エクステンションでは3 種類のツールが提供されている
  - 点密度
  - 線密度
  - カーネル密度
- 点密度 (Point Density)
  - 家屋の密度調査や、野生動物の観察などに使われる
  - 各ラスター セルの中心の周りに近傍範囲が定義され、近傍範囲内のポイント数の合計が、近傍の面積で除算される。
  - パラメーターを指定することによって、一部のポイントに他のポイントよりも大きい重みを付けたり、1 つのポイントを複数のポイントとしてカウントしたりすることができる
  - たとえば、1 つの住所で 8 世帯の集合住宅を表したり、軽犯罪よりも重犯罪に大きい重みを割り当てたりして解析することができる
- カーネル密度 (Kernel Density)
  - カーネル関数を使用してポイントまたはライン フィーチャから単位面積ごとの値を計算し、各ポイントまたはラインに滑らかなサーフェスを出力する
  - サーフェスの値はポイントの位置で最大になり、ポイントから離れるにしたがって小さくなり、検索半径で 0 になる
  - 検索範囲を大きくするほど、滑らかで単純化されたサーフェスが作成され、小さいほど詳細なサーフェスが作成される
  - 点密度 (Point Density) ツールと同様にパラメーターを指定して重みを付けることもできる。
- 線密度 (Line Density)
  - 野生生物の生息地に影響を与える道路の密度、市街地の電線や水道管の密度の特定などに使われる
  - パラメーターを指定して道路、電線、水道管などにサイズや等級に応じて他のものよりも大きい重みを付けることもできる
  - たとえば、中央分離帯のある高速道路は未舗装の細い道路よりも大きな影響があるように指定して解析することができる

===

# [可視性解析](https://www.esrij.com/gis-guide/spatial/visibility-analysis/)
## 可視性解析とは
- ある地点から目標物を見ようとした場合に、それが見えることを可視、見えないことを不可視という
- GIS では、地形や周辺の建物を考慮し、ある地点からの可視・不可視の判別を行うことができ、これを可視性解析と呼ぶ
- ArcGIS における可視性解析は、可視領域解析、見通し解析、スカイライン解析の 3 つに分類することができる。

## 可視領域解析
- 標高データを使用して、ある地点から見える場所を算出したり、ある地点を見ることができる場所を算出する。
- 標高データに建物情報を付加したデータを作成すれば、標高＋建物の高さから可視・不可視を算出し、「建物に遮られて見通せない領域」を求めることも可能。

## 見通し解析
- ある地点を結ぶラインの、最初と最後のポイント間の可視性を判断する。

## スカイライン解析
- ある観測点から見ることができる天空の広さや、特定の視点で障害物となり得るものを確認するなど、都市空間や建物に囲まれた空間を解析することができる
  - たとえば、ビルを新たに建設する際に、そのビルによって生じる周辺地域への影響をみることができる。

# [交通ネットワーク解析](https://www.esrij.com/gis-guide/spatial/network-analysis/)
## 交通ネットワーク解析とは
- グラフ理論
  - ノードの集合とエッジ（リンクと呼ぶこともある）の集合で構成されるグラフの性質を分析する数学の一分野
- ネットワーク分析
  - グラフ理論を基礎におき、物事をグラフとして抽象化し、そのグラフ構造を分析する手法
  - 社会ネットワーク分析や Web ページの検索システムなど、多くの分野・場面で用いられている
  - 交通ネットワーク解析もその 1 つであり、交差点をノード、道路をエッジとして表現したグラフ構造を分析する。

## 交通ネットワーク解析の種類
### 到達圏解析
- 到達圏解析
  - ある地点から交通ネットワークを用いた際に、指定した時間内あるいは距離内で到達することができる圏域を算出する

### 配車ルート（VRP: Vehicle Routing Problem）解析
- 配車ルート解析
  - スタート地点からグラフを構成するすべてのノードを経由して再びスタート地点に戻るときの移動コストを最小にする経路を求める巡回セールスマン問題と呼ばれるグラフ理論の問題を、実際の交通ネットワークに応用した解析
  - この解析では、拠点から複数の訪問先を巡る際の最適な訪問順とルートを算出する。

### ロケーション-アロケーション解析
- ロケーション-アロケーション解析
  - 施設の候補地点と需要地点との関係（移動コスト、施設の魅力度、施設の供給能力など）から最適な施設配置を分析する。
  - この解析では、施設がカバーする需要地点を最大にする方法や、施設と需要地点の移動コストを最小にする方法など、いくつかの解析方法が実装されている。

===

# [オーべーレイ解析](https://www.esrij.com/gis-guide/spatial/spatial-overlay/)
## オーバーレイとは
- GIS の世界では、地理的な要素（情報）を重ね合わせることを意味する。
- 地理的な要素を重ね合わせることにより、情報同士の関係性や新たな発見を導き出す解析を「オーバーレイ解析」と呼ぶ。


## オーバーレイ解析の種類
### クリップ
- データを任意の範囲で切り出す処理

### インターセクト
- 複数のデータ同士が重なり合う領域のみを抽出する処理

### イレース
- 重なり合う部分のデータを削除する処理

### ユニオン
- 複数のデータを統合する処理
- たとえば、地形分類データと、土地利用データがあった場合、重ね合わせてユニオン処理を行うと、出力結果には、地形分類の属性情報と土地利用の属性情報が両方格納される。

### 空間結合
- 2つのデータの空間的な関連性に基づいて属性情報を結合する

===

# [サーフェス解析](https://www.esrij.com/gis-guide/spatial/surface-analysis/)
## サーフェスとは
- GIS では 標高、気温、大気濃度など、連続的に変化する値を面的に表現したものをサーフェスと呼ぶ。
- サーフェスは、ラスターや TIN などのデータ モデルで表され、各セルやポイントにはその場所の高さや温度などの値が格納される。

## なぜサーフェスを解析するのか
- たとえば、標高サーフェスである数値標高データ（DEM）データの各セル値には、その場所の標高値が入力されているが、この標高サーフェスを見るだけでは、地形の特徴がよくわからない。
- 標高サーフェスを解析することで、地形の特徴が一目でわかるさまざまなデータを作成することができる。

### 等高線
- コンターや等値線とも呼ばれ、標高、温度、雨量、気圧などの値が同じ地点を結んだ線

### 傾斜方向
- 対象セルと近傍セルの下り傾斜角が最大の方向を特定し、斜面の方向を平坦、北、北東、東、南東、南、南西、西、北西の 9 色で色分けする

### 陰影起伏
- 仮想的に設定した光源から照らし出される影と光を表現
- 影が付くことにより、地形の起伏がわかりやすくなる。
- 陰影起伏レイヤーの上に標高レイヤーなどの他のレイヤーを重ねて、透過率を調整することで、立体的な視覚効果を得ることができる

### 傾斜角
- 対象セルと近傍セルの高さを比較し、その最大変化率に応じて色分けする
- 色が濃いほど角度が大きく、傾斜がきつい

### 可視領域
- ある地点から見える場所と見えない場所を色分けして表示

### 曲率
- 地形の凸凹を表現します。正の曲率はその場所が凸状であることを示し、負の曲率は凹上である

### 切り盛り
- 同じ場所の異なる時期の標高サーフェスを比較し、面積と体積が増加、減少した場所を特定

===

# [距離解析](https://www.esrij.com/gis-guide/spatial/distance_analysis/)
## 距離解析とは
- 出発地点から目的地までの経路を求めるために使用する GIS の解析機能のことを「距離解析」と呼ぶ
- 道路網を使用した現実的な経路を求めたり、2 点間の直線距離を求めたりすることができる

## ユークリッド距離解析
- セルから最も近いソース（出発地点）までの直線距離をセルごとに計測し、ラスターとして出力
- ユークリッド アルゴリズムで計算されるため、ユークリッド距離と呼ばれる
- セルの中心間の距離が計算される
- ソースが複数ある場合は、セルから最も近いソースまでの距離が格納される

## コスト距離解析
- ユークリッド距離が位置間の距離として直線であるのに対して、コスト距離は地表上の移動を考慮して算出する
- 通るルートの条件をコスト（負荷）として考慮して最適ルートを算出するのがコスト距離解析
- コストの例
  - 傾斜 (急こう配は通過できない)
  - 土地条件 (水域などは通過できない)
  - 地下構造 (地下にパイプラインwオ通すとき固い地盤は通りにくいなど)

===

# [日射量解析](https://www.esrij.com/gis-guide/spatial/solar_radiation/)
## 日射量解析とは
- 日射量解析
  - ある地点やエリアの全日射量を地形や周辺建物を含む人口構造物を考慮して算出する解析

## 日射量解析の詳細
- 日射量
  - 地球表面がうける太陽放射エネルギー量 (W/㎡)
- 日射量解析では、直達日射と錯乱日射を合わせた全天日射量を計測し、1 平方メートルあたりのワット数 (WH/㎡) を含んだラスターデータとして出力される
- 日射量は、標高や日時によっても変化するが、日射量解析を使用することで、傾斜角や傾斜方向、透過率や錯乱日射量の割合などの条件を細かく設定することができる。

## 日射量解析の種類
- エリアの日射量
  - 一定の範囲の日射量を解析
- ポイントの日射量
  - 特定の地点の日射量を解析

### エリアの日射量


### ポイントの日射量


### 解析の仕組み
- ArcGIS Spatial Analyst エクステンションを使用した日射量解析
- 入力データ
  - 標高モデル (DEM)
  - 日射量を算出したいエリアや位置のデータ
- 時間設定
  - 冬至や夏至、秋分の日、春分の日の特定の日の日射量
  - 1年の中での複数日の日射量
  - 月ごとの１年間の日射量
- オプションで散乱率や透過率の設定、直達日射・散乱日射・日照時間を出力できる設定もある

===

# [内挿](https://www.esrij.com/gis-guide/spatial/interpolation/)
## 内挿とは
- 「内挿（英語では interpolation）」
  - 既知の数値データ群（サンプル データ ポイント）をもとに、計算によって未知の部分の値を推定する手法

## 内挿は万能？
- 内挿が可能なのは、「空間に分布する複数のオブジェクト（物体や現象など）には空間的な相関がある」という前提があるから
- 言い換えると、近くにあるオブジェクト同士は類似の特性を持つ傾向があるということ

## 内挿はどのような場面で使われる？
- 内挿はおもに、標高、降雨、化学成分の濃度、騒音レベルといった値を補間する際に用いられる

## ArcGISで利用できる内挿の種類

|           内挿手法            |                    適用データ                    |              例               |
| ----------------------------- | ------------------------------------------------ | ----------------------------- |
| IDW (逆距離加重)              | サンプルの密度が高く、感覚が均等のデータ         | 標高 (数値地図など)           |
| クリギング                    | サンプル数が少ない、あるいは測定精度が低いデータ | 地質、大気中の物質濃度        |
| スプライン                    | サンプルの信頼性が高いデータ                     | 標高 (数値地図など)、気温分布 |
| Natural Neighbor (自然近傍法) | サンプルの密度が高いデータ                       | LIDAR                         |
| トレンド                      | 広範囲の傾向を把握する場合                       | 広範囲の汚染                  |

## まとめ

